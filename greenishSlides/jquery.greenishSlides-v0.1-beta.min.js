/*!
 * greenishSlides: jQuery Slideshow plugin - v0.1 - beta (4/6/2011)
 * http://www.philippadrian.com
 *
 * Copyright (c) 2011 Philipp C. Adrian
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 */
(function(a){a.fn.greenishSlides=function(g){var c=a(this),f,d,b;if(typeof(g)==="object"||!g){b=arguments;d="_init"}else{if(a.gS[g]){b=Array.prototype.slice.call(arguments,1);d=g}else{a.error(g+"doesn't exist")}}for(i=0;i<c.length;i++){f=a(c[i]).data("greenishSlidesData")||a(c[i]).parent().data("greenishSlidesData");if(f&&d=="_init"){a.gS.opts(f,g,true);continue}f=f||{context:a(c[i]),css:{},dcss:{},limits:{},hooks:[],slides:[],ai:-1,active:a(),};if(d=="_init"){f.opts=g=="_init"?Array.prototype.slice.call(arguments,1):g;b=[f]}else{b=[f].concat(b)}a(c[i]).data("greenishSlidesData",f);if(d=="triggerHook"){return a.gS[d].apply(this,b)}else{try{a.gS[d].apply(this,b)}catch(e){if(e!="triggerHook"){throw e}}}}return this};a.gS=a().greenishSlides;a.extend(a.gS,{timer:{},timing:function(c,f,b){return;var e,d;f=f||"";e=new Date();a.gS.timer[c]=a.gS.timer[c]||new Date();d=e-a.gS.timer[c];a.gS.timer[c]=e;if(true&&!b){console.log(c+":"+f+"////////////////////");console.log("Time: "+d+"ms")}},defaults:{stayOpen:false,resizable:false,vertical:false,circle:false,transitionSpeed:400,easing:"swing",events:{activate:"click",deactivate:"click"},keyEvents:false,swipeEvents:false,swipeThreshold:{x:30,y:10},hooks:{},limits:{},active:false,classes:{active:"active",vertical:"gSVertical",horizontal:"gSHorizontal",slide:"gSSlide"},handle:".gSSlide",cache:false},_init:function(g){c=g.context;f=a.gS.opts(g,g.opts,true);for(hooks in f.hooks){a.gS.bindHook(g,hooks,f.hooks[hooks])}g.context.greenishSlides("triggerHook","preInit");var b=a.gS,c=g.context,f=b.opts(g,g.opts,true),d=c.css(b.css.context).children().addClass(f.classes.slide).css(b.css.gSSlide),e;b.timing("init","Start");if(f.vertical){d.addClass(f.classes.vertical).css(b.css.gSVertical);a.extend(f,b.orientation.vertical)}else{d.addClass(f.classes.horizontal).css(b.css.gSHorizontal);a.extend(f,b.orientation.horizontal)}if(f.keyEvents){a(document).bind("keydown",function(h){if(h.which==39||h.which==40){c.greenishSlides("next")}else{if(h.which==37||h.which==38){c.greenishSlides("prev")}}})}if(f.swipeEvents&&c.swipe){c.swipe({threshold:f.swipeThreshold,swipeLeft:function(){c.greenishSlides("next")},swipeRight:function(){c.greenishSlides("prev")}})}e=!f.events.activate?"":f.events.activate+".gS focusin.gS ";e+=!f.events.deactivate?"":f.events.deactivate==f.events.activate?"focusout.gS ":f.events.deactivate+".gS focusout.gS ";if(!f.handle){e=f.events.activate="gSactivate"}c.bind(e,function(h){c.greenishSlides("event",h)});if(a("."+f.classes.active,c).length){a("."+f.classes.active,c).eq(0).removeClass(f.classes.active).trigger(f.events.activate,true)}else{if(f.active!==false){!isNaN(f.active)?d.eq(f.active).removeClass(f.classes.active).trigger(f.events.activate,true):a(f.active,c).eq(0).removeClass(f.classes.active).trigger(f.events.activate,true)}else{b.update(g)}}c.greenishSlides("triggerHook","postInit");b.timing("init","Done")},event:function(h,k,c){var j=a(k.target),f=h.opts,d=h.context,g,b;if(c){j=[j,j]}else{g=j.is(f.handle)?j:a(f.handle,d).has(j).eq(0),b=g.hasClass(f.classes.slide)?g:d.children().has(g);j=b.length?[b,g]:false}if((k.type=="focusin"||k.type==f.events.activate)&&j&&!j[0].hasClass(f.classes.active)){j[0].greenishSlides("triggerHook","preActivateEvent");j[0].greenishSlides("activate")}else{if(!f.stayOpen&&(k.type=="focusout"||k.type==f.events.deactivate)&&j&&j[0].hasClass(f.classes.active)&&j[1].has(k.relatedTarget).length<=0&&j[1]!=k.relatedTarget){j[0].greenishSlides("triggerHook","preDeactivateEvent");j[0].greenishSlides("deactivate")}}},activate:function(f){a.gS.timing("activation","Start",true);var c=a.gS,b=a(this),d=f.context,e=f.opts,g;!b.is("."+e.classes.slide+", ."+e.classes.slide+e.handle)?b=a("."+e.classes.slide).has(a(b)):b=a(b);if(b.hasClass(e.classes.active)){return}b.siblings("."+e.classes.active).removeClass(e.classes.active).addClass("gSdeactivated");g=b.siblings(".gSdeactivated");if(g.length>0){g.removeClass("gSdeactivated");b.greenishSlides("triggerHook","postDeactivate")}b.addClass(e.classes.active);f.active=b;f.ai=b.index();b.greenishSlides("triggerHook","preActivate");c.update(f)},deactivate:function(f){var c=a.gS,b=a(this),d=f.context,e=f.opts;!b.is("."+e.classes.slide+", ."+e.classes.slide+e.handle)?b=a("."+e.classes.slide).has(a(b)):b=a(b);if(!b.hasClass(e.classes.active)){return}b.removeClass(e.classes.active).addClass("gSdeactivated");b.greenishSlides("triggerHook","preDeactivate");f.active=a();f.ai="-1";c.update(f)},prev:function(h,d){var c=a.gS,f=h.context,g=h.opts,b,e=c._step(h,-1,d);if(e===undefined){e=f.children().length-1}e=f.greenishSlides("triggerHook","prev",e);b=f.children().eq(e);if(e!==false&&!b.hasClass(g.classes.active)){b.greenishSlides("activate")}},next:function(h,d){var c=a.gS,f=h.context,g=h.opts,b,e=c._step(h,1,d);if(e===undefined){e=0}e=f.greenishSlides("triggerHook","next",e);b=f.children().eq(e);if(e!==false&&!b.hasClass(g.classes.active)){b.greenishSlides("activate")}},_step:function(j,h,c){var b=a.gS,d=j.context,g=j.opts,f=d.children(),e;c=c||f.filter("."+g.classes.slide+"."+g.classes.active);if(!f.filter(c).length){return undefined}e=a(c).index()+(parseFloat(h)%f.length);if(e<0){g.circle?e=f.length+e:e=0}else{if(e>=f.length){g.circle?e=e-f.length:e=f.length-1}}return e},bindHook:function(e,d,c){c=typeof(c)=="function"?[c]:c;e.hooks[d]=e.hooks[d]||[];for(var b in c){e.hooks[d].push(c[b])}},triggerHook:function(d,c,e){if(d.hooks[c]&&d.hooks[c].length<=0){return e}for(var b in d.hooks[c]){if(e=d.hooks[c][b].apply(this,[d,e])!==false){continue}else{throw"triggerHook"}}return e},opts:function(d,c,b){c=a.extend(true,{},this.defaults,d.opts||{},c||{});if(b){d.opts=c}return c},_cssFloat:function(e,d){var c={minWidth:true,"min-width":true,minHeight:true,"min-height":true},b=c[d];d=e.css(d);if(b&&d=="0px"){return undefined}d=parseFloat(d.replace(["px","%"],""));return(!isNaN(d)?d:undefined)},_capitalize:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},clearCache:function(b){b.dcss={};b.limits={}},_getCSS:function(f,d){var b=a.gS,e=f.opts,c=f.context;slide=f.slides[d],ai=f.ai,css=f.css[d]=f.css[d]||{};posAct=slide.obj.hasClass("posAct"),alignLoT=ai==d&&slide.obj.hasClass(e.LoT);css[e.WoH]=slide.obj["outer"+b._capitalize(e.WoH)](true);slide.active=(d==ai?true:false);if(!e.resizable||!f.limited||d<ai||ai<0){if(!slide.obj.hasClass(e.LoT)||posAct){b._positioning(f,d,e.LoT)}else{slide.align=e.LoT;css[e.LoT]=slide.obj.position()[e.LoT]}}else{if(!slide.active){if(!slide.obj.hasClass(e.RoB)||posAct){b._positioning(f,d,e.RoB)}else{slide.align=e.RoB;css[e.RoB]=b._cssFloat(slide.obj,e.RoB)}}else{alignLoT?b._positioning(f,d,e.LoT,true):b._positioning(f,d,e.RoB,true)}}},_positioning:function(g,h,m,f){var l=a.gS,c=g.opts,e=g.context,j=g.slides[h],d=j.obj.position(),o=m==c.LoT?c.RoB:c.LoT,r=g.cS,n=j.obj["outer"+l._capitalize(c.WoH)](true),q=d[c.LoT],b=r-d[c.LoT]-n,k={};if(f){k.zIndex=0;k[c.WoH]="auto";g.css[h][c.LoT]=k[c.LoT]=q;g.css[h][c.RoB]=k[c.RoB]=b;j.obj.addClass("posAct")}else{k.zIndex=1;g.css[h][c.WoH]=k[c.WoH]=n;g.css[h][m]=k[m]=m==c.LoT?q:b;k[o]=g.css[h][o]="auto";j.obj.removeClass("posAct")}j.align=m;j.obj.removeClass(o).addClass(m).css(k)},_getLimits:function(g,h){var l=a.gS,c=g.opts,d=g.context,j=g.slides[h],f="-"+(g.slides.length-h),m=l._cssFloat(j.obj,"min-"+c.WoH),e=l._cssFloat(j.obj,"max-"+c.WoH),b={max:!isNaN(e)?e:c.limits[h]&&!isNaN(c.limits[h].max)?c.limits[h].max:c.limits[f]&&!isNaN(c.limits[f].max)?c.limits[f].max:!isNaN(c.limits.max)?c.limits.max:undefined,min:!isNaN(m)?m:c.limits[h]&&!isNaN(c.limits[h].min)?c.limits[h].min:c.limits[f]&&!isNaN(c.limits[f].min)?c.limits[f].min:!isNaN(c.limits.min)?c.limits.min:undefined};if(m&&m>b.max){b.max=m}if(e&&e<b.min){b.min=e}if(b.min||b.max){g.limited=true}return b},_getDCss:function(j){var m=a.gS,b=j.opts,d=j.context,o=j.ai,p={},l=j.slides.length,e=cS=j.cS,k,f,h,n,g={};for(h=n=0;slide=j.slides[h];h++){if(!slide.active){n+=j.limits[h].min||0}g[h]={}}if(o>=0&&(isNaN(j.limits[o].max)||j.limits[o].max>cS-n)){for(h=0;h<l;h++){h==o?g[h][b.WoH]=cS-n:g[h][b.WoH]=j.limits[h].min||0}}else{k=e/l;for(h=0;limit=j.limits[h];h++){f=(limit.max<k);if(!p[h]&&(limit.min>k||f||h==o)){p[h]=true;l--;f||h==o?e-=g[h][b.WoH]=limit.max:e-=g[h][b.WoH]=limit.min;k=e/l;h=-1}}for(h=0;h<j.slides.length;h++){if(!p[h]){g[h][b.WoH]=k}}}for(h=n=0;slide=j.slides[h];h++){n+=g[h][b.WoH];if(!b.resizable||!j.limited||h<o||o<0){g[h][b.LoT]=n-g[h][b.WoH]}else{if(h!=o){g[h][b.RoB]=cS-n}else{g[h][b.LoT]=n-g[h][b.WoH];g[h][b.RoB]=cS-n}}}return g},_getData:function(h){a.gS.timing("update","Start",true);var k=a.gS,e=h.context,c=h.opts,d=e.children(),f=h.active,l=h.ai,j,g=h.dcss=c.cache?h.dcss:{},b=h.limits=c.cache?h.limits:{};h.limited=c.cache?h.limited:false;h.cS=c.cache&&h.cS?h.cS:e["inner"+k._capitalize(c.WoH)]();for(j=d.length-1;j>=0;j--){h.slides[j]=h.slides[j]||{obj:d.eq(j)};h.limits[j]=h.limits[j]||k._getLimits(h,j);k._getCSS(h,j)}h.dcss[l]=h.dcss[l]||k._getDCss(h)},update:function(h,g){var d=a.gS,e=h.context.stop(),f=e.children(),j=h.active,c=h.ai,b,h;g=d.opts(h,g);d._getData(h);if(j.length<=0){j.greenishSlides("triggerHook","preDeactivateAnimation");b=function(){e.greenishSlides("postDeactivate")}}else{j.greenishSlides("triggerHook","preActivateAnimation");b=function(){e.greenishSlides("postActivate")}}e.dequeue("gSpreAnimation").css({textIndent:0}).animate({textIndent:100},{duration:g.transitionSpeed,easing:g.easing,complete:b,step:d._animationStep}).dequeue("gSpostAnimation");a.gS.timing("activation","done")},postActivate:function(b){if(b.ai>0){b.active.greenishSlides("triggerHook","postActivate")}},postDeactivate:function(c){var b=a(this).find("."+c.opts.classes.slide+".gSdeactivated");if(b.length>0){b.greenishSlides("triggerHook","postDeactivate");b.removeClass("gSdeactivated")}},_animationStep:function(c,g){a.gS.timing("step","start",true);var h=a(g.elem).dequeue("gSanimationStep").data("greenishSlidesData");try{if(!h){throw h}a.gS.triggerHook(h,"step")}catch(e){a(this).stop();return}var b=h.opts,j=h.dcss[h.ai],p=h.ai,n={},m={},l,d,f,o=h.slides[p]&&h.slides[p].align==b.LoT?b.RoB:b.LoT;calc=function(q,k){return Math.round(h.css[q][k]+((j[q][k]-h.css[q][k])*c))},getPosition=function(k,q){return n[k]?n[k][q]+n[k][b.WoH]:0},percent=function(k){if(c!=1||!b.resizable||h.limited||true){return k}return(100*k/h.cS)+"%"};c/=100;for(f=h.slides.length-1;l=h.slides[f];f--){n[f]={};m[f]={};h.css[f][l.align]=h.css[f][l.align]||0;n[f][l.align]=calc(f,l.align);if(l.active&&b.resizable&&h.limited){m[f][o]=n[f][o]=calc(f,o)}m[f][l.align]=n[f][l.align]}for(f=h.slides.length-1;l=h.slides[f];f--){if(l.active&&b.resizable&&h.limited){n[f][b.WoH]=h.cS-n[f][l.align]-n[f][o]}else{d=(l.align==b.LoT?f+1:f-1);h.slides[d]?n[f][b.WoH]=n[d][l.align]-n[f][l.align]:n[f][b.WoH]=h.cS-n[f][l.align];m[f][b.WoH]=percent(n[f][b.WoH])}l.obj.css(m[f])}a.gS.timing("step","end",true)},orientation:{horizontal:{WoH:"width",LoT:"left",RoB:"right"},vertical:{WoH:"height",LoT:"top",RoB:"bottom"}},css:{context:{zoom:1,listStyle:"none",padding:0,},gSSlide:{position:"absolute",margin:0,border:0,padding:0,display:"block",overflow:"hidden",textIndent:0},gSHorizontal:{height:"100%",top:0},gSVertical:{width:"100%",left:0}}})})(jQuery);